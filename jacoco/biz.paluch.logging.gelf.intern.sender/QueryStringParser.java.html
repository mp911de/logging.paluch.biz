<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="de"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>QueryStringParser.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">logstash logging connectors</a> &gt; <a href="index.source.html" class="el_package">biz.paluch.logging.gelf.intern.sender</a> &gt; <span class="el_source">QueryStringParser.java</span></div><h1>QueryStringParser.java</h1><pre class="source lang-java linenums">package biz.paluch.logging.gelf.intern.sender;

import java.net.URI;
import java.util.Collections;
import java.util.HashMap;
import java.util.Map;
import java.util.StringTokenizer;
import java.util.concurrent.TimeUnit;

/**
 * Query string parser for {@link URI} query strings.
 * 
 * @author Mark Paluch
 */
<span class="nc" id="L15">class QueryStringParser {</span>

    private static final Map&lt;String, TimeUnit&gt; TIME_UNIT_MAP;

    static {
<span class="fc" id="L20">        Map&lt;String, TimeUnit&gt; unitMap = new HashMap&lt;String, TimeUnit&gt;();</span>
<span class="fc" id="L21">        unitMap.put(&quot;ns&quot;, TimeUnit.NANOSECONDS);</span>
<span class="fc" id="L22">        unitMap.put(&quot;us&quot;, TimeUnit.MICROSECONDS);</span>
<span class="fc" id="L23">        unitMap.put(&quot;ms&quot;, TimeUnit.MILLISECONDS);</span>
<span class="fc" id="L24">        unitMap.put(&quot;s&quot;, TimeUnit.SECONDS);</span>
<span class="fc" id="L25">        unitMap.put(&quot;m&quot;, TimeUnit.MINUTES);</span>
<span class="fc" id="L26">        unitMap.put(&quot;h&quot;, TimeUnit.HOURS);</span>
<span class="fc" id="L27">        unitMap.put(&quot;d&quot;, TimeUnit.DAYS);</span>
<span class="fc" id="L28">        TIME_UNIT_MAP = Collections.unmodifiableMap(unitMap);</span>
<span class="fc" id="L29">    }</span>

    /**
     * Parse the query part of an {@link URI} to a single-valued key-value map. All keys are transformed to lower-case.
     * 
     * @param uri
     * @return the key-value map.
     */
    static Map&lt;String, String&gt; parse(URI uri) {

<span class="fc" id="L39">        Map&lt;String, String&gt; result = new HashMap&lt;String, String&gt;();</span>

<span class="fc" id="L41">        String queryString = uri.getQuery();</span>
<span class="pc bpc" id="L42" title="2 of 6 branches missed.">        if (queryString == null &amp;&amp; uri.getSchemeSpecificPart() != null &amp;&amp; uri.getSchemeSpecificPart().contains(&quot;?&quot;)) {</span>
<span class="fc" id="L43">            queryString = uri.getSchemeSpecificPart().substring(uri.getSchemeSpecificPart().indexOf('?') + 1);</span>
        }

<span class="fc bfc" id="L46" title="All 2 branches covered.">        if (queryString == null) {</span>
<span class="fc" id="L47">            return result;</span>
        }

<span class="fc" id="L50">        StringTokenizer st = new StringTokenizer(queryString, &quot;&amp;;&quot;);</span>
<span class="fc bfc" id="L51" title="All 2 branches covered.">        while (st.hasMoreTokens()) {</span>
<span class="fc" id="L52">            String queryParam = st.nextToken();</span>
<span class="fc" id="L53">            int equalsIndex = queryParam.indexOf('=');</span>
<span class="pc bpc" id="L54" title="1 of 2 branches missed.">            if (equalsIndex != -1) {</span>
<span class="fc" id="L55">                String key = queryParam.substring(0, equalsIndex);</span>
<span class="fc" id="L56">                String value = queryParam.substring(equalsIndex + 1);</span>

<span class="fc" id="L58">                result.put(key.toLowerCase(), value);</span>
            }
<span class="fc" id="L60">        }</span>

<span class="fc" id="L62">        return result;</span>
    }

    static long getTimeAsMs(Map&lt;String, String&gt; map, String key, long defaultTimeMs) {

<span class="fc" id="L67">        String value = map.get(key.toLowerCase());</span>
<span class="pc bpc" id="L68" title="1 of 4 branches missed.">        if (value == null || value.trim().equals(&quot;&quot;)) {</span>
<span class="fc" id="L69">            return defaultTimeMs;</span>
        }

<span class="fc" id="L72">        int numbersEnd = 0;</span>
<span class="fc bfc" id="L73" title="All 4 branches covered.">        while (numbersEnd &lt; value.length() &amp;&amp; Character.isDigit(value.charAt(numbersEnd))) {</span>
<span class="fc" id="L74">            numbersEnd++;</span>
        }

<span class="pc bpc" id="L77" title="1 of 2 branches missed.">        if (numbersEnd == 0) {</span>
<span class="nc" id="L78">            return defaultTimeMs;</span>
        }
<span class="fc" id="L80">        String numbers = value.substring(0, numbersEnd);</span>
<span class="fc" id="L81">        long timeValue = Long.parseLong(numbers);</span>

<span class="fc" id="L83">        String suffix = value.substring(numbersEnd);</span>
<span class="fc" id="L84">        TimeUnit timeoutUnit = TIME_UNIT_MAP.get(suffix);</span>
<span class="fc bfc" id="L85" title="All 2 branches covered.">        if (timeoutUnit == null) {</span>
<span class="fc" id="L86">            timeoutUnit = TimeUnit.MILLISECONDS;</span>
        }

<span class="fc" id="L89">        return timeoutUnit.toMillis(timeValue);</span>
    }

    public static int getInt(Map&lt;String, String&gt; map, String key, int defaultValue) {

<span class="fc" id="L94">        String value = map.get(key.toLowerCase());</span>
<span class="pc bpc" id="L95" title="1 of 4 branches missed.">        if (value == null || value.trim().equals(&quot;&quot;)) {</span>
<span class="fc" id="L96">            return defaultValue;</span>
        }
<span class="fc" id="L98">        return Integer.parseInt(value);</span>
    }

    public static boolean getString(Map&lt;String, String&gt; map, String key, boolean defaultValue) {

<span class="fc" id="L103">        String value = map.get(key.toLowerCase());</span>
<span class="pc bpc" id="L104" title="3 of 4 branches missed.">        if (value == null || value.trim().equals(&quot;&quot;)) {</span>
<span class="fc" id="L105">            return defaultValue;</span>
        }
<span class="nc" id="L107">        return &quot;true&quot;.equalsIgnoreCase(value);</span>
    }

    public static String getHost(URI uri) {

<span class="fc" id="L112">        String host = uri.getHost();</span>
<span class="fc bfc" id="L113" title="All 2 branches covered.">        if (host == null) {</span>
<span class="fc" id="L114">            host = uri.getSchemeSpecificPart();</span>
        }

<span class="fc bfc" id="L117" title="All 2 branches covered.">        if (host.contains(&quot;?&quot;)) {</span>
<span class="fc" id="L118">            host = host.substring(0, host.indexOf(&quot;?&quot;));</span>
        }
<span class="fc" id="L120">        return host;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>